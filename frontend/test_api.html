<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API数据测试页面</title>
    <link rel="stylesheet" href="antd.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 24px;
            margin-bottom: 24px;
        }
        h1, h2 {
            margin-top: 0;
            color: #1890ff;
        }
        .btn {
            background-color: #1890ff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 8px;
            margin-bottom: 8px;
        }
        .btn:hover {
            background-color: #40a9ff;
        }
        .btn-secondary {
            background-color: #6c757d;
        }
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        .log-output {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 16px;
            height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', Courier, monospace;
            white-space: pre-wrap;
        }
        .data-display {
            margin-top: 20px;
            padding: 16px;
            border: 1px solid #e8e8e8;
            border-radius: 4px;
        }
        pre {
            background: #f6ffed;
            border: 1px solid #b7eb8f;
            padding: 16px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .step {
            margin-bottom: 24px;
            padding: 16px;
            background: #fafafa;
            border-radius: 4px;
            border-left: 4px solid #1890ff;
        }
        .note {
            background: #fff7e6;
            border: 1px solid #ffd591;
            padding: 16px;
            border-radius: 4px;
            margin-top: 16px;
        }
        .success {
            color: #52c41a;
        }
        .error {
            color: #ff4d4f;
        }
        .info {
            color: #1890ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>字典应用API数据测试</h1>
        <p>此页面用于演示系统的数据是从API获取的，而不是写死的。请打开浏览器的开发者工具（按F12）查看控制台中的API调用日志。</p>
        
        <div class="step">
            <h2>步骤1: 测试字典列表API</h2>
            <button class="btn" onclick="testDictionariesAPI()">获取字典列表</button>
            <div id="dictionaries-data" class="data-display"></div>
        </div>
        
        <div class="step">
            <h2>步骤2: 测试单词列表API</h2>
            <button class="btn" onclick="testWordsAPI()">获取所有单词</button>
            <button class="btn btn-secondary" onclick="testWordsWithSearchAPI()">搜索单词</button>
            <div id="words-data" class="data-display"></div>
        </div>
        
        <div class="step">
            <h2>步骤3: 测试单词详情API</h2>
            <button class="btn" onclick="testWordDetailAPI()">获取单词详情</button>
            <div id="word-detail-data" class="data-display"></div>
        </div>
        
        <div class="note">
            <h3>重要说明</h3>
            <p>1. 系统设计为优先从后端API获取数据，所有数据操作（查询、添加、编辑、删除）都会先尝试调用相应的API端点。</p>
            <p>2. 在API调用失败的情况下（例如后端服务未运行），系统会自动切换到本地模拟数据，确保前端功能可以正常展示。</p>
            <p>3. 所有的API调用都会在浏览器控制台中输出详细的日志信息，您可以通过F12打开开发者工具查看。</p>
            <p>4. API端点包括：<code>/api/dictionaries</code>、<code>/api/words</code>、<code>/words/{id}</code>等。</p>
        </div>
    </div>

    <div class="container">
        <h2>控制台日志输出</h2>
        <div id="console-output" class="log-output"></div>
    </div>

    <script>
        // 重写console.log以在页面上显示日志
        const originalConsoleLog = console.log;
        const originalConsoleError = console.error;
        const originalConsoleInfo = console.info;
        
        function updateConsoleOutput(text, type = 'log') {
            const consoleOutput = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'error' ? 'error' : type === 'info' ? 'info' : 'success';
            
            consoleOutput.innerHTML += `<span class="${colorClass}">[${timestamp}] ${text}</span>\n`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }
        
        console.log = function() {
            const args = Array.from(arguments).map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : arg
            ).join(' ');
            originalConsoleLog.apply(console, arguments);
            updateConsoleOutput(args, 'log');
        };
        
        console.error = function() {
            const args = Array.from(arguments).map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : arg
            ).join(' ');
            originalConsoleError.apply(console, arguments);
            updateConsoleOutput(args, 'error');
        };
        
        console.info = function() {
            const args = Array.from(arguments).map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : arg
            ).join(' ');
            originalConsoleInfo.apply(console, arguments);
            updateConsoleOutput(args, 'info');
        };
        
        // API请求函数（与系统中使用的相同）
        function apiRequest(url, method = 'GET', data = null, mockData = null) {
            console.log(`API请求: ${method} ${url}`);
            if (data) {
                console.log('请求数据:', data);
            }
            
            return new Promise((resolve, reject) => {
                fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: data ? JSON.stringify(data) : null
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('API响应成功:', data);
                    resolve(data);
                })
                .catch(error => {
                    console.error('API请求失败:', error.message);
                    if (mockData !== null) {
                        console.info('使用模拟数据作为备选方案');
                        resolve(mockData);
                    } else {
                        reject(error);
                    }
                });
            });
        }
        
        // 测试字典列表API
        function testDictionariesAPI() {
            console.log('开始测试字典列表API...');
            const mockDictionaries = [
                { dictionary_id: 1, name: '英语四级词汇', description: '大学英语四级核心词汇', created_at: '2024-01-01T00:00:00Z' },
                { dictionary_id: 2, name: '日常英语口语', description: '日常生活常用英语表达', created_at: '2024-01-02T00:00:00Z' },
                { dictionary_id: 3, name: '商务英语词汇', description: '商务场合常用英语词汇', created_at: '2024-01-03T00:00:00Z' }
            ];
            
            apiRequest('/api/dictionaries', 'GET', null, mockDictionaries)
                .then(data => {
                    const dictionariesData = document.getElementById('dictionaries-data');
                    dictionariesData.innerHTML = `<h3>获取到 ${data.length} 个字典</h3><pre>${JSON.stringify(data, null, 2)}</pre>`;
                })
                .catch(error => {
                    const dictionariesData = document.getElementById('dictionaries-data');
                    dictionariesData.innerHTML = `<div class="error">错误: ${error.message}</div>`;
                });
        }
        
        // 测试单词列表API
        function testWordsAPI() {
            console.log('开始测试单词列表API...');
            const mockWords = [
                { word_id: 1, word: 'apple', phonetic: '/ˈæpl/', meaning: 'n. 苹果', dictionaries: [1, 2], created_at: '2024-01-01T00:00:00Z' },
                { word_id: 2, word: 'banana', phonetic: '/bəˈnɑːnə/', meaning: 'n. 香蕉', dictionaries: [1], created_at: '2024-01-02T00:00:00Z' },
                { word_id: 3, word: 'computer', phonetic: '/kəmˈpjuːtər/', meaning: 'n. 计算机', dictionaries: [1, 3], created_at: '2024-01-03T00:00:00Z' }
            ];
            
            apiRequest('/api/words', 'GET', null, mockWords)
                .then(data => {
                    const wordsData = document.getElementById('words-data');
                    wordsData.innerHTML = `<h3>获取到 ${data.length} 个单词</h3><pre>${JSON.stringify(data, null, 2)}</pre>`;
                })
                .catch(error => {
                    const wordsData = document.getElementById('words-data');
                    wordsData.innerHTML = `<div class="error">错误: ${error.message}</div>`;
                });
        }
        
        // 测试带搜索的单词列表API
        function testWordsWithSearchAPI() {
            console.log('开始测试带搜索的单词列表API...');
            const keyword = 'app';
            const mockWords = [
                { word_id: 1, word: 'apple', phonetic: '/ˈæpl/', meaning: 'n. 苹果', dictionaries: [1, 2], created_at: '2024-01-01T00:00:00Z' },
                { word_id: 4, word: 'application', phonetic: '/ˌæplɪˈkeɪʃn/', meaning: 'n. 应用', dictionaries: [3], created_at: '2024-01-04T00:00:00Z' }
            ];
            
            apiRequest(`/api/words?keyword=${keyword}`, 'GET', null, mockWords)
                .then(data => {
                    const wordsData = document.getElementById('words-data');
                    wordsData.innerHTML = `<h3>搜索 "${keyword}" 获取到 ${data.length} 个单词</h3><pre>${JSON.stringify(data, null, 2)}</pre>`;
                })
                .catch(error => {
                    const wordsData = document.getElementById('words-data');
                    wordsData.innerHTML = `<div class="error">错误: ${error.message}</div>`;
                });
        }
        
        // 测试单词详情API
        function testWordDetailAPI() {
            console.log('开始测试单词详情API...');
            const wordId = 1;
            const mockWordDetail = {
                word_id: 1,
                word: 'apple',
                phonetic: '/ˈæpl/',
                meaning: 'n. 苹果；苹果树；苹果公司',
                pronunciation1: '/audio/apple_us.mp3',
                pronunciation2: '/audio/apple_uk.mp3',
                dictionaries: [1, 2],
                created_at: '2024-01-01T00:00:00Z'
            };
            
            apiRequest(`/words/${wordId}`, 'GET', null, mockWordDetail)
                .then(data => {
                    const wordDetailData = document.getElementById('word-detail-data');
                    wordDetailData.innerHTML = `<h3>单词ID ${wordId} 的详细信息</h3><pre>${JSON.stringify(data, null, 2)}</pre>`;
                })
                .catch(error => {
                    const wordDetailData = document.getElementById('word-detail-data');
                    wordDetailData.innerHTML = `<div class="error">错误: ${error.message}</div>`;
                });
        }
        
        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('API测试页面加载完成');
            console.log('请点击上方按钮测试各个API端点');
            console.log('所有API调用都会在这里显示详细日志');
        });
    </script>
</body>
</html>